### TDC Spec version 0.1
注意`sync`信号何时变为低电平，是否当下一个`trigger`到来之后，仍为高电平，`sync`会持续两个周期的高电平(640 ns).

__解决__：
1. 使用两个`sync`模块，两个不同的`sync`信号，交替使用
2. 在`sync`模块中添加控制信号，使其在下个`clk`上升沿拉低，这样也会持续一个`clk`高电平(320 ns).
3. 下一个`trigger`上升沿不要来的过早，与前一个`trigger`的`negedge`尽量延迟.

__问题__：
1. `trigger`信号的所有可能出现的情况;
2. `INT`中断产生后，控制`light pulse`为无效的脉冲;
3. `TDC_INT`信号是一个周期的脉冲还是，从计数器溢出到下一个`start`到来期间都为高电平？
4. 使用`trigger`下降沿时刻判断强度大小并且替换存储，是否可行？ 方法2：使用`clk5`的上升沿采`sync`，根据是否为高电平，
5. 最后一个`trigger`信号，与下一次`start`间隔要长.
6. 跨时钟域问题，比如:250 Mhz的`clk`上升沿采`hs`.
7. 考虑`valid`时，不`ready`,以及握手信号持续到下一次`start`.
8. 假如直到溢出，没有`pulse`，即`TDC_Onum`为0时，需要输出`valid`信号吗？`TDC_Olast`?
9.  需要仿真一下，两个`trigger`的间隔很近的情况下，`sync`信号是否能够正常输出？前一个`trigger`的下降沿跟后面一个`trigger`的上升沿间隔需要至少一个周期(320 ns)?
10. TDC的线性度


__todo__:
1. ~~等待`sync`信号修改;~~
2. ~~`sync`下降沿或者上升沿之后，输出给模拟端一个4ns(两个周期)的`pulse`，同时屏蔽掉`trigger`的上升沿(此时模拟端控制不产生`time gate`);~~
3. ~~`pulse`下降沿比较强度`INT`大小，是否替换存储`tof data`; 实际上与`clk5`同步;~~
4. 没有数据也需要握手，告诉core logic数据长度为0，等待握手完成后，~~core logic给出一个复位信号(需要同步？)，与全局reset相或，对存储进行复位;~~
5. 通讯状态机，`IDLE`状态还要输出`TDC_Onum`?
6. ~~计数器计满之后，屏蔽`trigger`;增加一条屏蔽线，或者仍使`INT`为0？~~

没有数据也需要握手？
7. 与晓峰沟通，`INT`位宽为5位，增加屏蔽信号，复位信号等。
8. `range`为几位？何时握手？
9.  INT信号为脉冲，或者持续高电平？何时拉高，溢出瞬间还是同步到250Mhz？
10. valid可以瞬间拉高？还是？
11. 需要保证，trigger下降后4ns内无上升沿到来。


__1.5__
1. 可以利用transdone信号，拉高后可以复位
2. transdone信号可以通过状态机输出
3. 计数器溢出后，延迟几个4ns，确保溢出前一刻的数据被采集到buffer中，然后计算强度，通过4级流水，指出信号valid的时刻

__1.6__
1. tof的计算时间有限，可能也需要先存到buffer，然后后续计算。
2. 比较tof数值和range大小，方法是否可行？
3. 等待clr信号给出
4. start高电平持续时间？
5. 写spec

__TDC__
1. 目前，当得到的tof data超过量程之后，同样认为该数据有效，并且输出全1，是否需要通过判断是否溢出，从而修改Onum减一

__histogram__
1. 根据强度是否满足>阈值，控制计数器加一，直到计满Ibatch
2. 4K速率输出是否可以？